name: Claude Code Validation

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  validate-claude-config:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: CLAUDE.mdã®å­˜åœ¨ç¢ºèª
      run: |
        if [ ! -f "CLAUDE.md" ]; then
          echo "âŒ CLAUDE.mdãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
          exit 1
        fi
        echo "âœ… CLAUDE.mdãŒå­˜åœ¨ã—ã¾ã™"
        
    - name: .claude.jsonã®å­˜åœ¨ç¢ºèª
      run: |
        if [ ! -f ".claude.json" ]; then
          echo "âŒ .claude.jsonãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
          exit 1
        fi
        echo "âœ… .claude.jsonãŒå­˜åœ¨ã—ã¾ã™"
        
    - name: .claude.jsonã®æ§‹æ–‡ãƒã‚§ãƒƒã‚¯
      run: |
        if ! jq empty .claude.json; then
          echo "âŒ .claude.jsonã®æ§‹æ–‡ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“"
          exit 1
        fi
        echo "âœ… .claude.jsonã®æ§‹æ–‡ã¯æ­£ã—ã„ã§ã™"
        
    - name: .claude/settings.local.jsonã®å­˜åœ¨ç¢ºèª
      run: |
        if [ ! -f ".claude/settings.local.json" ]; then
          echo "âŒ .claude/settings.local.jsonãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
          exit 1
        fi
        echo "âœ… .claude/settings.local.jsonãŒå­˜åœ¨ã—ã¾ã™"
        
    - name: .claude/settings.local.jsonã®æ§‹æ–‡ãƒã‚§ãƒƒã‚¯
      run: |
        if ! jq empty .claude/settings.local.json; then
          echo "âŒ .claude/settings.local.jsonã®æ§‹æ–‡ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“"
          exit 1
        fi
        echo "âœ… .claude/settings.local.jsonã®æ§‹æ–‡ã¯æ­£ã—ã„ã§ã™"
        
    - name: .gitignoreã®ç¢ºèª
      run: |
        if [ ! -f ".gitignore" ]; then
          echo "âŒ .gitignoreãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
          exit 1
        fi
        echo "âœ… .gitignoreãŒå­˜åœ¨ã—ã¾ã™"
        
    - name: .editorconfigã®ç¢ºèª
      run: |
        if [ ! -f ".editorconfig" ]; then
          echo "âŒ .editorconfigãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
          exit 1
        fi
        echo "âœ… .editorconfigãŒå­˜åœ¨ã—ã¾ã™"
        
    - name: .env.exampleã®ç¢ºèª
      run: |
        if [ ! -f ".env.example" ]; then
          echo "âŒ .env.exampleãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
          exit 1
        fi
        echo "âœ… .env.exampleãŒå­˜åœ¨ã—ã¾ã™"
        
    - name: åŸºæœ¬ãƒ•ã‚¡ã‚¤ãƒ«ã®è¡Œæ•°ãƒã‚§ãƒƒã‚¯
      run: |
        echo "ğŸ“Š ãƒ•ã‚¡ã‚¤ãƒ«ã®è¡Œæ•°ç¢ºèª:"
        echo "- CLAUDE.md: $(wc -l < CLAUDE.md) è¡Œ"
        echo "- .claude.json: $(wc -l < .claude.json) è¡Œ"
        echo "- .claude/settings.local.json: $(wc -l < .claude/settings.local.json) è¡Œ"
        echo "- .gitignore: $(wc -l < .gitignore) è¡Œ"
        echo "- .editorconfig: $(wc -l < .editorconfig) è¡Œ"
        echo "- .env.example: $(wc -l < .env.example) è¡Œ"
        echo "- README.md: $(wc -l < README.md) è¡Œ"
        
    - name: CLAUDE.mdã®å†…å®¹ç¢ºèª
      run: |
        echo "ğŸ“ CLAUDE.mdã®å†…å®¹ãƒã‚§ãƒƒã‚¯:"
        if grep -q "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦" CLAUDE.md; then
          echo "âœ… ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒã‚ã‚Šã¾ã™"
        else
          echo "âš ï¸ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™"
        fi
        
        if grep -q "æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯" CLAUDE.md; then
          echo "âœ… æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒã‚ã‚Šã¾ã™"
        else
          echo "âš ï¸ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™"
        fi
        
        if grep -q "ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„" CLAUDE.md; then
          echo "âœ… ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒã‚ã‚Šã¾ã™"
        else
          echo "âš ï¸ ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™"
        fi
        
    - name: .claude.jsonã®MCPã‚µãƒ¼ãƒãƒ¼è¨­å®šç¢ºèª
      run: |
        echo "ğŸ”§ MCPã‚µãƒ¼ãƒãƒ¼è¨­å®šãƒã‚§ãƒƒã‚¯:"
        if jq -e '.mcpServers' .claude.json > /dev/null; then
          echo "âœ… mcpServersãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã™"
          echo "è¨­å®šã•ã‚Œã¦ã„ã‚‹ã‚µãƒ¼ãƒãƒ¼:"
          jq -r '.mcpServers | keys[]' .claude.json | sed 's/^/- /'
        else
          echo "âš ï¸ mcpServersãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“"
        fi
        
    - name: æ¤œè¨¼å®Œäº†
      run: |
        echo "ğŸ‰ ã™ã¹ã¦ã®åŸºæœ¬ãƒã‚§ãƒƒã‚¯ãŒå®Œäº†ã—ã¾ã—ãŸï¼"
        echo "Claude Codeãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®è¨­å®šãŒæ­£ã—ãè¡Œã‚ã‚Œã¦ã„ã¾ã™ã€‚"